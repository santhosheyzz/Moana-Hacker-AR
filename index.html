<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Moana AR Puzzle – Project SYN-01</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar.js"></script>
    <style>
      body { margin: 0; overflow: hidden; font-family: 'Poppins', sans-serif; }

      #hud {
        position: absolute; top: 10px; left: 10px;
        background: rgba(0,0,0,0.55); color: white;
        padding: 10px 15px; border-radius: 10px;
        z-index: 20; max-width: 90%;
      }

      #inputBox {
        position: absolute; bottom: 8%; left: 50%;
        transform: translateX(-50%);
        background: rgba(255,255,255,0.92);
        border-radius: 12px; padding: 12px 18px;
        box-shadow: 0 0 10px rgba(0,0,0,0.3);
        z-index: 25; display: none; text-align: center;
      }

      #inputBox input {
        padding: 8px; width: 160px;
        border-radius: 6px; border: 1px solid #aaa;
        font-size: 16px; text-align: center;
      }

      #inputBox button {
        margin-left: 10px;
        background: #00b894; border: none; color: #fff;
        padding: 8px 12px; border-radius: 6px; cursor: pointer;
      }

      #message {
        position: absolute;
        left: 50%; top: 50%; transform: translate(-50%,-50%);
        background: rgba(0,0,0,0.7); color: #fff;
        padding: 20px 25px; border-radius: 12px;
        display: none; z-index: 40; font-size: 20px;
      }

      #confetti {
        position: absolute; left: 0; top: 0; width: 100%; height: 100%;
        pointer-events: none; display: none;
      }
    </style>
  </head>
  <body>
    <div id="hud">
      <b>Project SYN-01</b><br>
      Scan the Moana marker to hear her clue and enter the secret code.
    </div>

    <div id="inputBox">
      <div><b>Question:</b> What code that will be?</div><br>
      <input id="answerInput" placeholder="Enter code..." maxlength="5" />
      <button id="submitBtn">Submit</button>
    </div>

    <div id="message"></div>
    <canvas id="confetti"></canvas>

    <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false;">
      <a-entity camera></a-entity>

      <a-marker id="moanaMarker" preset="hiro">
        <!-- Moana 3D Model -->
        <a-gltf-model id="moanaModel" src="moana.glb"
                      position="0 0 0"
                      scale="0.4 0.4 0.4"
                      rotation="0 180 0"
                      animation="property: rotation; to: 0 360 0; loop: true; dur: 12000; easing: linear;">
        </a-gltf-model>

        <!-- Audio Clue -->
        <a-entity id="moanaVoice" sound="src: url(clue.mp3); autoplay: false;"></a-entity>

        <!-- Floating Text -->
        <a-text value="I heard the ocean hum a code..."
                position="0 1.6 0"
                align="center"
                color="#00ffff"
                scale="1.5 1.5 1.5"></a-text>
      </a-marker>
    </a-scene>

    <script>
      const marker = document.querySelector('#moanaMarker');
      const voice = document.querySelector('#moanaVoice');
      const inputBox = document.querySelector('#inputBox');
      const answerInput = document.querySelector('#answerInput');
      const submitBtn = document.querySelector('#submitBtn');
      const message = document.querySelector('#message');
      const confettiCanvas = document.querySelector('#confetti');
      const correctCode = '3';

      // play Moana's voice + show question when marker found
      marker.addEventListener('markerFound', () => {
        voice.components.sound.playSound();
        inputBox.style.display = 'block';
      });

      marker.addEventListener('markerLost', () => {
        inputBox.style.display = 'none';
      });

      // check answer
      submitBtn.addEventListener('click', () => {
        const ans = answerInput.value.trim();
        if(!ans) return;

        if(ans === correctCode){
          celebrate();
        } else {
          message.textContent = '❌ Wrong Code! Try again.';
          message.style.background = 'rgba(255,0,0,0.8)';
          message.style.display = 'block';
          setTimeout(()=> message.style.display='none', 1500);
        }
      });

      // celebration (AR fireworks)
      function celebrate(){
        message.textContent = '✅ Access Granted! The system is free.';
        message.style.background = 'rgba(0,200,100,0.85)';
        message.style.display = 'block';
        inputBox.style.display = 'none';

        // simple confetti
        confettiCanvas.style.display = 'block';
        const ctx = confettiCanvas.getContext('2d');
        confettiCanvas.width = window.innerWidth;
        confettiCanvas.height = window.innerHeight;

        const confetti = [];
        for(let i=0;i<120;i++){
          confetti.push({
            x: Math.random()*window.innerWidth,
            y: Math.random()*window.innerHeight - window.innerHeight,
            r: Math.random()*6+2,
            c: `hsl(${Math.random()*360},100%,50%)`,
            s: Math.random()*4+2
          });
        }

        function draw(){
          ctx.clearRect(0,0,confettiCanvas.width,confettiCanvas.height);
          confetti.forEach(p=>{
            p.y += p.s;
            if(p.y > confettiCanvas.height) p.y = -10;
            ctx.beginPath();
            ctx.arc(p.x,p.y,p.r,0,Math.PI*2);
            ctx.fillStyle=p.c;
            ctx.fill();
          });
          requestAnimationFrame(draw);
        }
        draw();

        // stop after 3 seconds
        setTimeout(()=>{
          message.style.display='none';
          confettiCanvas.style.display='none';
        }, 3000);
      }
    </script>
  </body>
</html>
