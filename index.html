<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Moana AR Puzzle – Project SYN-01</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar.js"></script>
    <style>
      body { margin: 0; overflow: hidden; font-family: 'Poppins', sans-serif; background: black; }
      #startButton {
        position: absolute; top: 45%; left: 50%; transform: translate(-50%,-50%);
        background: linear-gradient(45deg,#00ff88,#00b894);
        color: black; font-weight: 600; font-size: 18px;
        border: none; border-radius: 10px; padding: 15px 25px;
        cursor: pointer; z-index: 50;
      }
      #hud {
        position: absolute; top: 10px; left: 10px;
        background: rgba(0,0,0,0.55); color: white;
        padding: 10px 15px; border-radius: 10px;
        z-index: 20;
      }
      #inputBox {
        position: absolute; bottom: 8%; left: 50%;
        transform: translateX(-50%);
        background: rgba(255,255,255,0.92);
        border-radius: 12px; padding: 12px 18px;
        box-shadow: 0 0 10px rgba(0,0,0,0.3);
        z-index: 25; display: none; text-align: center;
      }
      #inputBox input {
        padding: 8px; width: 160px;
        border-radius: 6px; border: 1px solid #aaa;
        font-size: 16px; text-align: center;
      }
      #inputBox button {
        margin-left: 10px;
        background: #00b894; border: none; color: #fff;
        padding: 8px 12px; border-radius: 6px; cursor: pointer;
      }
      #message {
        position: absolute;
        left: 50%; top: 50%; transform: translate(-50%,-50%);
        background: rgba(0,0,0,0.7); color: #fff;
        padding: 20px 25px; border-radius: 12px;
        display: none; z-index: 40; font-size: 20px;
      }
      #matrixCanvas {
        position: absolute; left: 0; top: 0; width: 100%; height: 100%;
        pointer-events: none; display: none; z-index: 35;
      }
    </style>
  </head>

  <body>
    <button id="startButton">Start AR Experience</button>

    <div id="hud">
      <b>Project SYN-01</b><br>
      Scan the Moana marker to hear her clue and enter the secret code.
    </div>

    <div id="inputBox">
      <div><b>Question:</b> What code will it be?</div><br>
      <input id="answerInput" placeholder="Enter code..." maxlength="5" />
      <button id="submitBtn">Submit</button>
    </div>

    <div id="message"></div>
    <canvas id="matrixCanvas"></canvas>

    <!-- A-Frame Scene -->
    <a-scene id="scene"
             embedded
             vr-mode-ui="enabled: false"
             renderer="logarithmicDepthBuffer: true; antialias: true;"
             arjs="trackingMethod: best; sourceType: webcam; debugUIEnabled: false;"
             style="display:none;">
      <a-assets crossorigin="anonymous">
        <a-asset-item id="moanaAsset" src="moana3d.glb"></a-asset-item>
        <audio id="clueAudio" src="clue.mp3"></audio>
      </a-assets>

      <a-entity camera></a-entity>

      <a-marker id="moanaMarker" type="pattern" url="Kanji_marker_ARjs.png">
        <a-gltf-model id="moanaModel"
                      src="#moanaAsset"
                      position="0 0 0"
                      scale="0.5 0.5 0.5"
                      rotation="0 180 0"
                      crossorigin="anonymous"
                      animation="property: rotation; to: 0 360 0; loop: true; dur: 12000; easing: linear;">
        </a-gltf-model>

        <a-entity id="moanaVoice" sound="src: #clueAudio; autoplay: false;"></a-entity>

        <a-text value="I heard the ocean hum a code..."
                position="0 1.6 0"
                align="center"
                color="#00ffff"
                scale="1.5 1.5 1.5"></a-text>
      </a-marker>
    </a-scene>

    <script>
      const startButton = document.getElementById('startButton');
      const scene = document.getElementById('scene');
      const marker = document.getElementById('moanaMarker');
      const voice = document.getElementById('moanaVoice');
      const inputBox = document.getElementById('inputBox');
      const answerInput = document.getElementById('answerInput');
      const submitBtn = document.getElementById('submitBtn');
      const message = document.getElementById('message');
      const matrixCanvas = document.getElementById('matrixCanvas');
      const correctCode = '3';

      startButton.addEventListener('click', () => {
        startButton.style.display = 'none';
        scene.style.display = 'block';
      });

      marker.addEventListener('markerFound', () => {
        console.log('Marker detected!');
        try { voice.components.sound.playSound(); } catch(e){ console.warn(e); }
        inputBox.style.display = 'block';
      });
      marker.addEventListener('markerLost', () => {
        inputBox.style.display = 'none';
      });

      submitBtn.addEventListener('click', () => {
        const ans = answerInput.value.trim();
        if(!ans) return;
        if(ans === correctCode) hackerCelebrate();
        else {
          message.textContent = '❌ Wrong Code! Try again.';
          message.style.background = 'rgba(255,0,0,0.8)';
          message.style.display = 'block';
          setTimeout(()=> message.style.display='none', 1500);
        }
      });

      function hackerCelebrate(){
        message.textContent = '✅ Access Granted! Decrypting...';
        message.style.background = 'rgba(0,200,100,0.85)';
        message.style.display = 'block';
        inputBox.style.display = 'none';

        matrixCanvas.style.display = 'block';
        matrixCanvas.width = window.innerWidth;
        matrixCanvas.height = window.innerHeight;
        const ctx = matrixCanvas.getContext('2d');
        const chars = '01';
        const fontSize = 16;
        const columns = Math.floor(matrixCanvas.width / fontSize);
        const drops = [];
        for(let x=0;x<columns;x++) drops[x]=Math.random()*matrixCanvas.height/2;
        ctx.font = fontSize+'px monospace';
        let running = true;
        function draw(){
          if(!running) return;
          ctx.fillStyle='rgba(0,0,0,0.05)';
          ctx.fillRect(0,0,matrixCanvas.width,matrixCanvas.height);
          for(let i=0;i<drops.length;i++){
            const text = chars.charAt(Math.floor(Math.random()*chars.length));
            ctx.fillStyle='#00ff6a';
            ctx.fillText(text,i*fontSize,drops[i]*fontSize);
            drops[i]++;
            if(drops[i]*fontSize>matrixCanvas.height && Math.random()>0.975) drops[i]=0;
          }
          requestAnimationFrame(draw);
        }
        draw();
        setTimeout(()=>{
          running=false;
          matrixCanvas.style.display='none';
          message.style.display='none';
        },3000);
      }
    </script>
  </body>
</html>
